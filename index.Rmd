--- 
title: "Covariate Adjustment in Randomized Trials"
author: "Josh Betz, Kelly van Lancker, and Michael Rosenblum"
site: bookdown::bookdown_site
documentclass: book
bibliography: covariate_adjustment.bib
url: https://covariateadjustment.github.io
# cover-image: path to the social sharing image like images/cover.jpg
description: |
  This a series of tutorials meant to help investigators apply covariate
  adjusted analyses in randomized trials.
link-citations: yes
github-repo: covariateadjustment/covariateadjustment.github.io
---

```{r Book-Setup, echo = FALSE, message = FALSE}
library(tidyverse)
library(table1)

### Set Default Options ########################################################
fig_w <- 8
fig_h <- 8

knitr::opts_chunk$set(
  echo = TRUE,
  message = FALSE,
  results = "markup",
  fig.width = fig_w,
  fig.height = fig_h,
  fig.align = "center",
  out.width = "80%",
  dpi = 300,
  dev = "CairoPNG"
)

set.seed(54321)

if(!file.exists(file.path(getwd(), "docs", ".nojekyll"))){
  file.create(file.path(getwd(), "docs", ".nojekyll"))
} 
```

# The Book

  - This book is about covariate adjustment for practitioners planning and analyzing randomized trials 
  - Marginal Effects: what they are, why we are focusing on them.
    - References on where to find more on conditional effects
  - Goals for covariate adjusted approach
    - We do not want to change the target of inference
    - We want to have the same or better precision (asymptotically) as the unadjusted estimator
    - We want assumptions to be as strict as the unadjusted estimator, if not less strict.
  - We want to provide methods and examples that are broadly applicable:
    - Continuous, binary, ordinal, time-to-event outcomes
    - Applicable to various areas
    - Avoid methods with pathological behavior, such as lack of convergence
  - Potential Benefits:
    - Increased power for same sample size or same power at lower sample size
      - Particularly beneficial in larger trials
    - More ethical, efficient trials
    - Generally supported by regulatory agencies
  - Challenges to Address:
    - Precision gain not known a priori
    - Need a theoretical framework which includes a broad class of estimators
    - Missing data: dropout, not yet collected
    - No 'off the shelf' software solutions
    - Reviewer skepticism
    - General guidance and rules for application
    




--------------------------------------------------------------------------------




## Using this Book

This book is meant to provide worked examples to help practitioners apply covariate adjustment in practice. The material will be most accessible to a reader who has a good understanding of probability and statistics (confidence intervals, hypothesis testing), generalized linear models, and survival analysis. Some familiarity with concepts in randomized trials and causal inference is helpful, but not required. In order to make these methods broadly available, we provide worked examples using the R environment for statistical computing, which is free and open source software. While not all users may be familiar with R, we provide example code and links to additional resources to help users understand how to apply it in practice. The data in our examples are simulated from actual randomized trial data, meant to mimic key features such as missingness patterns and the distribution of outcomes and covariates.

We will start with an overview of key ideas and findings from research in randomized trial methodology. From there, we will discuss different targets of inference, or estimands, that may be of interest to investigators. Afterwards, we provide a brief overview of using R, and how to install the necessary software to perform covariate adjustment. With the necessary background in place, we will begin with the most simple and commonly used approach for covariate adjustment, the analysis of covariance (ANCOVA), show how this approach can be generalized to binary and other types of outcomes. From there, we will discuss how to address the issues of missing data in baseline covariates and outcomes using doubly robust methods.

Since randomized trials are often designed with incomplete and imprecise information, the study design should incorporate pre-planned analyses to determine if the study should continue or be stopped for either success or futility. We discuss how covariate adjustment can be integrated into such analysis plans. Finally, we discuss some recommendations for applying these methods in practice.




--------------------------------------------------------------------------------




## Case Studies

The datasets used in our examples are simulated data based on actual randomized trials, with considerable effort spent making the data as realistic as possible. The original study data was used to create regression models for the outcomes of interest and missingness patterns. Next, simulated covariate data were created by resampling the original covariate data, and perturbing the resampled data. Simulated outcome data and missingness patterns were generated using predictions from the outcome regression models, using the simulated covariates as input.




--------------------------------------------------------------------------------




### Buprenorphine tapering schedule and illicit opioid use: CTN-03 {#ctn_03}

[CTN-03](https://pubmed.ncbi.nlm.nih.gov/19149822) ([NCT00078117](https://clinicaltrials.gov/show/NCT00078117)) was two-arm a phase III trial to compare two potential tapering schedules of the drug buprenorphine, a pharmacotherapy for opioid dependence. At the time of the study design, there was considerable variation in tapering schedules in practice, and a knowledge gap in terms of the best way to administer buprenorphine to control withdrawal symptoms and give the greatest chance of abstinence at the end of treatment. It was hypothesized that a longer taper schedule would result in greater likelihood of a participant being retained on study and providing opioid-free urine samples at the end of the drug taper schedule.

Participants were randomized 1:1 to a 7-day or 28-day taper using stratified block randomization across 11 sites in 10 US cities. Randomization was stratified by the maintenance dose of buprenorphine at stabilization: 8, 16, or 24 mg. The structure of the CTN-03 simulated data is as follows:

  - Baseline Covariates
    - `age`: Participant age at baseline
    - `sex`: Participant sex
    - `race`: Participant race
    - `ethnic`: Participant ethnicity
    - `marital`: Participant marital status
  - Randomization Information
    - `arm`: Treatment Arm
    - `stability_dose`: Stratification Factor
  - Baseline (`_bl`) & End-Of-Taper (`_eot`) Outcomes:
    - `arsw_score`: Adjective Rating Scale for Withdrawal (ARSW) Score at baseline
    - `cows_score`: Clinical Opiate Withdrawal Scale (COWS) Score at baseline
    - `cows_category`: COWS Severity Category - Ordinal
    - `vas_crave_opiates`: Visual Analog Scale (VAS) - Self report of opiate cravings
    - `vas_current_withdrawal`: Visual Analog Scale (VAS) - Current withdrawal symptoms
    - `vas_study_tx_help`: Visual Analog Scale (VAS) - Study treatment helping symptoms
    - `uds_opioids`: Urine Drug Screen Result - Opioids
    - `uds_oxycodone`: Urine Drug Screen Result - Oxycodone
    - `uds_any_positive`: Urine Drug Screen - Any positive result




--------------------------------------------------------------------------------




### Functional Outcome in Hemorrhagic Stroke: MISTIE III {#mistie_iii}

Hemorrhagic stroke occurs when a blood vessel in the brain ruptures, causing a bleed inside the skull. The bleeding from an ICH can occur in the brain tissue itself (an intracerebral hemorrhage, or ICH), or in the fluid-filled channels in the brain (an intraventricular hemorrhage, or IVH). The [MISTIE III](https://doi.org/10.1016/s0140-6736(19)30195-3) trial ([NCT01827046](https://clinicaltrials.gov/show/NCT01827046)) was a phase III study comparing a minimally invasive surgical intervention to conventional medical management for the treatment of spontaneous, non-traumatic ICH.

In this study, participants were randomized 1:1 to receive either standard-of-care medical management or a minimal invasive surgery with Alteplase for ICH removal. Outcomes were measured at 30, 180, and 365-days post-randomization using the Modified Rankin Scale (MRS), which measures functional outcome on a scale ranging from 0 (no residual symptoms) to 6 (death). The MRS was collapsed into a binary variable, representing a score of 0-3 (no symptoms to moderate disability but able to walk without assistance) or 4-6 (unable to walk or attend to daily activities without assistance to death). Survival was also assessed, with patients administratively censored on the date of their final MRS assessment.

The data from MISTIE III was used to create a synthetic dataset for educational purposes. Baseline covariates include demographics, medications and comorbidities, characteristics of the stroke (location of the ICH lesion, the size of the ICH and IVH lesions on CT scans), and neurological status on presentation to the hospital (the Glasgow Coma Scale, or GCS).

In addition to the longitudinal measures of the MRS at 30-, 180-, and 365-days post randomization, mortality data are included. The structure of the data is as follows:

  - `sim_participant_id`: Patient id
  - Baseline Covariates
    - `age`: Age in years
    - `male`: male sex
    - `hx_cvd`:	cardiovascular disease history
    - `hx_hyperlipidemia`:	hyperlipidemia history
    - `on_anticoagulants`:	on anticoagulant medication
    - `on_antiplatelets`:	on antiplatelet medication
    - `ich_location`: intracerebral hemorrhage location: (`Lobar`, `Deep`)
    - `ich_s_volume`:	intracerebral hemorrhage volume on stability scan
    - `ivh_s_volume`:	intraventricular hemorrhage volume on stability scan
    - `gcs_category`: presenting Glasgow Coma Score (GCS)
  - Treatment:
    - `arm`: treatment arm
    - `ich_eot_volume`: intracerebral hemorrhage volume on end-of-treatment scan
  - Outcome:
    - `mrs_30d`: MRS at 30 days (`0-3`, `4`, `5`, `6`)
    - `mrs_30d_complete`: MRS at 30 days if no data were missing
    - `mrs_180d`: MRS at 180 days (`0-2`, `3`, `4`, `5`, `6`)
    - `mrs_180d_complete`: MRS at 180 days if no data were missing
    - `mrs_365d`: MRS at 365 days (`0-1`, `2`, `3`, `4`, `5`, `6`)
    - `mrs_365d_complete`: MRS at 365 days if no data were missing
    - `days_on_study`: days until death or administrative censoring
    - `died_on_study`: participant died (`1`) or is censored (`0`)
